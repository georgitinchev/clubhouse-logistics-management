@page
@model MediaBazaarWebsite.Pages.AvailabilityCalendarModel
@{
}

<<form method="post">
    <div id="calendar">
        <div id="calendar-header">
            <h3>@Model.CurrentMonthName @Model.CurrentYear</h3>
        </div>
        <table id="calendar-body">
            <tr>
                @foreach (var dayName in Model.DayNames)
                {
                    <th>@dayName</th>
                }
            </tr>
            @for (int week = 0; week < Model.Weeks.Count; week++)
            {
                <tr>
                    @for (int day = 0; day < Model.Weeks[week].Count; day++)
                    {
                        var date = Model.Weeks[week][day];
                        <td class="@(date.Month == Model.CurrentMonth ? "" : "other-month") @(date == Model.Today ? "today" : "")">
                            @date.Day
                            <ul>
                                @foreach (var slot in Model.TimeSlots)
                                {
                                    var value = $"{date.ToShortDateString()} - {slot}";
                                    <li>
                                        <label>
                                            <input type="checkbox" name="selectedTimeSlots" value="@value"
                                            @(Model.SelectedTimeSlots.Contains(value) ? "checked" : "") /> @* Check if pre-selected *@
                                            @slot
                                        </label>
                                    </li>
                                }
                            </ul>
                        </td>
                    }
                </tr>
            }
        </table>
        <div>
            <button type="submit">Submit</button>
        </div>
    </div>
</form>






<script>
    const checkboxes = document.querySelectorAll('input[type="checkbox"]');
    const timeSlots = ['Morning', 'Afternoon', 'Evening'];

    checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function () {
            const [date, selectedSlot] = this.value.split(' - ');
            const selectedSlotIndex = timeSlots.indexOf(selectedSlot);

            const checkedForDate = Array.from(checkboxes)
                .filter(cb => cb.value.startsWith(date) && cb.checked)
                .map(cb => cb.value.split(' - ')[1])
                .map(slot => timeSlots.indexOf(slot));

            if (checkedForDate.length > 2) {
                this.checked = false;
                alert('You can only select up to 2 time slots per day.');
                return; // Exit the function if the maximum is exceeded
            }
            if (checkedForDate.length === 2) {
                // Check if the slots are consecutive
                checkedForDate.sort();
                if (checkedForDate[1] - checkedForDate[0] !== 1) {
                    this.checked = false;
                    alert('You can only select consecutive time slots (e.g., Morning & Afternoon, or Afternoon & Evening).');
                }
            }
        });
    });
</script>